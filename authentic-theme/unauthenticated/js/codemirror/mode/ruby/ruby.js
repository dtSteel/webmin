(function(a){if(typeof exports=="object"&&typeof module=="object"){a(require("../../lib/codemirror"))}else{if(typeof define=="function"&&define.amd){define(["../../lib/codemirror"],a)}else{a(CodeMirror)}}})(function(a){a.defineMode("ruby",function(f){function b(t){var s={};for(var q=0,r=t.length;q<r;++q){s[t[q]]=true}return s}var k=b(["alias","and","BEGIN","begin","break","case","class","def","defined?","do","else","elsif","END","end","ensure","false","for","if","in","module","next","not","or","redo","rescue","retry","return","self","super","then","true","undef","unless","until","when","while","yield","nil","raise","throw","catch","fail","loop","callcc","caller","lambda","proc","public","protected","private","require","load","require_relative","extend","autoload","__END__","__FILE__","__LINE__","__dir__"]);var j=b(["def","class","case","for","while","until","module","then","catch","loop","proc","begin"]);var e=b(["end","until"]);var d={"[":"]","{":"}","(":")"};var n;function c(q,s,r){r.tokenize.push(q);return q(s,r)}function g(w,u){if(w.sol()&&w.match("=begin")&&w.eol()){u.tokenize.push(m);return"comment"}if(w.eatSpace()){return null}var t=w.next(),q;if(t=="`"||t=="'"||t=='"'){return c(o(t,"string",t=='"'||t=="`"),w,u)}else{if(t=="/"){if(l(w)){return c(o(t,"string-2",true),w,u)}else{return"operator"}}else{if(t=="%"){var s="string",x=true;if(w.eat("s")){s="atom"}else{if(w.eat(/[WQ]/)){s="string"}else{if(w.eat(/[r]/)){s="string-2"}else{if(w.eat(/[wxq]/)){s="string";x=false}}}}var v=w.eat(/[^\w\s=]/);if(!v){return"operator"}if(d.propertyIsEnumerable(v)){v=d[v]}return c(o(v,s,x,true),w,u)}else{if(t=="#"){w.skipToEnd();return"comment"}else{if(t=="<"&&(q=w.match(/^<-?[\`\"\']?([a-zA-Z_?]\w*)[\`\"\']?(?:;|$)/))){return c(i(q[1]),w,u)}else{if(t=="0"){if(w.eat("x")){w.eatWhile(/[\da-fA-F]/)}else{if(w.eat("b")){w.eatWhile(/[01]/)}else{w.eatWhile(/[0-7]/)}}return"number"}else{if(/\d/.test(t)){w.match(/^[\d_]*(?:\.[\d_]+)?(?:[eE][+\-]?[\d_]+)?/);return"number"}else{if(t=="?"){while(w.match(/^\\[CM]-/)){}if(w.eat("\\")){w.eatWhile(/\w/)}else{w.next()}return"string"}else{if(t==":"){if(w.eat("'")){return c(o("'","atom",false),w,u)}if(w.eat('"')){return c(o('"',"atom",true),w,u)}if(w.eat(/[\<\>]/)){w.eat(/[\<\>]/);return"atom"}if(w.eat(/[\+\-\*\/\&\|\:\!]/)){return"atom"}if(w.eat(/[a-zA-Z$@_\xa1-\uffff]/)){w.eatWhile(/[\w$\xa1-\uffff]/);w.eat(/[\?\!\=]/);return"atom"}return"operator"}else{if(t=="@"&&w.match(/^@?[a-zA-Z_\xa1-\uffff]/)){w.eat("@");w.eatWhile(/[\w\xa1-\uffff]/);return"variable-2"}else{if(t=="$"){if(w.eat(/[a-zA-Z_]/)){w.eatWhile(/[\w]/)}else{if(w.eat(/\d/)){w.eat(/\d/)}else{w.next()}}return"variable-3"}else{if(/[a-zA-Z_\xa1-\uffff]/.test(t)){w.eatWhile(/[\w\xa1-\uffff]/);w.eat(/[\?\!]/);if(w.eat(":")){return"atom"}return"ident"}else{if(t=="|"&&(u.varList||u.lastTok=="{"||u.lastTok=="do")){n="|";return null}else{if(/[\(\)\[\]{}\\;]/.test(t)){n=t;return null}else{if(t=="-"&&w.eat(">")){return"arrow"}else{if(/[=+\-\/*:\.^%<>~|]/.test(t)){var r=w.eatWhile(/[=+\-\/*:\.^%<>~|]/);if(t=="."&&!r){n="."}return"operator"}else{return null}}}}}}}}}}}}}}}}}function l(u){var v=u.pos,t=0,q,r=false,s=false;while((q=u.next())!=null){if(!s){if("[{(".indexOf(q)>-1){t++}else{if("]})".indexOf(q)>-1){t--;if(t<0){break}}else{if(q=="/"&&t==0){r=true;break}}}s=q=="\\"}else{s=false}}u.backUp(u.pos-v);return r}function p(q){if(!q){q=1}return function(s,r){if(s.peek()=="}"){if(q==1){r.tokenize.pop();return r.tokenize[r.tokenize.length-1](s,r)}else{r.tokenize[r.tokenize.length-1]=p(q-1)}}else{if(s.peek()=="{"){r.tokenize[r.tokenize.length-1]=p(q+1)}}return g(s,r)}}function h(){var q=false;return function(s,r){if(q){r.tokenize.pop();return r.tokenize[r.tokenize.length-1](s,r)}q=true;return g(s,r)}}function o(q,r,t,s){return function(x,v){var w=false,u;if(v.context.type==="read-quoted-paused"){v.context=v.context.prev;x.eat("}")}while((u=x.next())!=null){if(u==q&&(s||!w)){v.tokenize.pop();break}if(t&&u=="#"&&!w){if(x.eat("{")){if(q=="}"){v.context={prev:v.context,type:"read-quoted-paused"}}v.tokenize.push(p());break}else{if(/[@\$]/.test(x.peek())){v.tokenize.push(h());break}}}w=!w&&u=="\\"}return r}}function i(q){return function(s,r){if(s.match(q)){r.tokenize.pop()}else{s.skipToEnd()}return"string"}}function m(r,q){if(r.sol()&&r.match("=end")&&r.eol()){q.tokenize.pop()}r.skipToEnd();return"comment"}return{startState:function(){return{tokenize:[g],indented:0,context:{type:"top",indented:-f.indentUnit},continuedLine:false,lastTok:null,varList:false}},token:function(v,s){n=null;if(v.sol()){s.indented=v.indentation()}var r=s.tokenize[s.tokenize.length-1](v,s),u;var q=n;if(r=="ident"){var t=v.current();r=s.lastTok=="."?"property":k.propertyIsEnumerable(v.current())?"keyword":/^[A-Z]/.test(t)?"tag":(s.lastTok=="def"||s.lastTok=="class"||s.varList)?"def":"variable";if(r=="keyword"){q=t;if(j.propertyIsEnumerable(t)){u="indent"}else{if(e.propertyIsEnumerable(t)){u="dedent"}else{if((t=="if"||t=="unless")&&v.column()==v.indentation()){u="indent"}else{if(t=="do"&&s.context.indented<s.indented){u="indent"}}}}}}if(n||(r&&r!="comment")){s.lastTok=q}if(n=="|"){s.varList=!s.varList}if(u=="indent"||/[\(\[\{]/.test(n)){s.context={prev:s.context,type:n||r,indented:s.indented}}else{if((u=="dedent"||/[\)\]\}]/.test(n))&&s.context.prev){s.context=s.context.prev}}if(v.eol()){s.continuedLine=(n=="\\"||r=="operator")}return r},indent:function(u,q){if(u.tokenize[u.tokenize.length-1]!=g){return 0}var t=q&&q.charAt(0);var s=u.context;var r=s.type==d[t]||s.type=="keyword"&&/^(?:end|until|else|elsif|when|rescue)\b/.test(q);return s.indented+(r?0:f.indentUnit)+(u.continuedLine?f.indentUnit:0)},electricInput:/^\s*(?:end|rescue|elsif|else|\})$/,lineComment:"#"}});a.defineMIME("text/x-ruby","ruby")});