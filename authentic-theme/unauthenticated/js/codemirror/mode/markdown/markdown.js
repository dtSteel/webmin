(function(a){if(typeof exports=="object"&&typeof module=="object"){a(require("../../lib/codemirror"),require("../xml/xml"),require("../meta"))}else{if(typeof define=="function"&&define.amd){define(["../../lib/codemirror","../xml/xml","../meta"],a)}else{a(CodeMirror)}}})(function(a){a.defineMode("markdown",function(E,o){var j=a.getMode(E,"text/html");var d=j.name=="null";function f(I){if(a.findModeByName){var J=a.findModeByName(I);if(J){I=J.mime||J.mimes[0]}}var K=a.getMode(E,I);return K.name=="null"?null:K}if(o.highlightFormatting===undefined){o.highlightFormatting=false}if(o.maxBlockquoteDepth===undefined){o.maxBlockquoteDepth=0}if(o.taskLists===undefined){o.taskLists=false}if(o.strikethrough===undefined){o.strikethrough=false}if(o.tokenTypeOverrides===undefined){o.tokenTypeOverrides={}}var q={header:"header",code:"comment",quote:"quote",list1:"variable-2",list2:"variable-3",list3:"keyword",hr:"hr",image:"image",imageAltText:"image-alt-text",imageMarker:"image-marker",formatting:"formatting",linkInline:"link",linkEmail:"link",linkText:"link",linkHref:"string",em:"em",strong:"strong",strikethrough:"strikethrough"};for(var G in q){if(q.hasOwnProperty(G)&&o.tokenTypeOverrides[G]){q[G]=o.tokenTypeOverrides[G]}}var H=/^([*\-_])(?:\s*\1){2,}\s*$/,z=/^(?:[*\-+]|^[0-9]+([.)]))\s+/,B=/^\[(x| )\](?=\s)/,p=o.allowAtxHeaderWithoutSpace?/^(#+)/:/^(#+)(?: |$)/,D=/^ *(?:\={1,}|-{1,})\s*$/,h=/^[^#!\[\]*_\\<>` "'(~]+/,C=new RegExp("^("+(o.fencedCodeBlocks===true?"~~~+|```+":o.fencedCodeBlocks)+")[ \\t]*([\\w+#-]*)"),l=/[!\"#$%&\'()*+,\-\.\/:;<=>?@\[\\\]^_`{|}~â€”]/;function g(K,J,I){J.f=J.inline=I;return I(K,J)}function v(K,J,I){J.f=J.block=I;return I(K,J)}function t(I){return !I||!/\S/.test(I.string)}function s(I){I.linkTitle=false;I.em=false;I.strong=false;I.strikethrough=false;I.quote=0;I.indentedCode=false;if(I.f==y){I.f=u;I.block=n}I.trailingSpace=0;I.trailingSpaceNewLine=false;I.prevLine=I.thisLine;I.thisLine=null;return null}function n(O,N){var M=O.sol();var K=N.list!==false,I=N.indentedCode;N.indentedCode=false;if(K){if(N.indentationDiff>=0){if(N.indentationDiff<4){N.indentation-=N.indentationDiff}N.list=null}else{if(N.indentation>0){N.list=null}else{N.list=false}}}var J=null;if(N.indentationDiff>=4){O.skipToEnd();if(I||t(N.prevLine)){N.indentation-=4;N.indentedCode=true;return q.code}else{return null}}else{if(O.eatSpace()){return null}else{if((J=O.match(p))&&J[1].length<=6){N.header=J[1].length;if(o.highlightFormatting){N.formatting="header"}N.f=N.inline;return x(N)}else{if(!t(N.prevLine)&&!N.quote&&!K&&!I&&(J=O.match(D))){N.header=J[0].charAt(0)=="="?1:2;if(o.highlightFormatting){N.formatting="header"}N.f=N.inline;return x(N)}else{if(O.eat(">")){N.quote=M?1:N.quote+1;if(o.highlightFormatting){N.formatting="quote"}O.eatSpace();return x(N)}else{if(O.peek()==="["){return g(O,N,m)}else{if(O.match(H,true)){N.hr=true;return q.hr}else{if(J=O.match(z)){var L=J[1]?"ol":"ul";N.indentation=O.column()+O.current().length;N.list=true;while(N.listStack&&O.column()<N.listStack[N.listStack.length-1]){N.listStack.pop()}N.listStack.push(N.indentation);if(o.taskLists&&O.match(B,false)){N.taskList=true}N.f=N.inline;if(o.highlightFormatting){N.formatting=["list","list-"+L]}return x(N)}else{if(o.fencedCodeBlocks&&(J=O.match(C,true))){N.fencedChars=J[1];N.localMode=f(J[2]);if(N.localMode){N.localState=a.startState(N.localMode)}N.f=N.block=w;if(o.highlightFormatting){N.formatting="code-block"}N.code=-1;return x(N)}}}}}}}}}return g(O,N,N.inline)}function y(L,K){var J=j.token(L,K.htmlState);if(!d){var I=a.innerMode(j,K.htmlState);if((I.mode.name=="xml"&&I.state.tagStart===null&&(!I.state.context&&I.state.tokenize.isInText))||(K.md_inside&&L.current().indexOf(">")>-1)){K.f=u;K.block=n;K.htmlState=null}}return J}function w(K,J){if(J.fencedChars&&K.match(J.fencedChars)){if(o.highlightFormatting){J.formatting="code-block"}var I=x(J);J.localMode=J.localState=null;J.block=n;J.f=u;J.fencedChars=null;J.code=0;return I}else{if(J.fencedChars&&K.skipTo(J.fencedChars)){return"comment"}else{if(J.localMode){return J.localMode.token(K,J.localState)}else{K.skipToEnd();return q.code}}}}function x(L){var K=[];if(L.formatting){K.push(q.formatting);if(typeof L.formatting==="string"){L.formatting=[L.formatting]}for(var I=0;I<L.formatting.length;I++){K.push(q.formatting+"-"+L.formatting[I]);if(L.formatting[I]==="header"){K.push(q.formatting+"-"+L.formatting[I]+"-"+L.header)}if(L.formatting[I]==="quote"){if(!o.maxBlockquoteDepth||o.maxBlockquoteDepth>=L.quote){K.push(q.formatting+"-"+L.formatting[I]+"-"+L.quote)}else{K.push("error")}}}}if(L.taskOpen){K.push("meta");return K.length?K.join(" "):null}if(L.taskClosed){K.push("property");return K.length?K.join(" "):null}if(L.linkHref){K.push(q.linkHref,"url")}else{if(L.strong){K.push(q.strong)}if(L.em){K.push(q.em)}if(L.strikethrough){K.push(q.strikethrough)}if(L.linkText){K.push(q.linkText)}if(L.code){K.push(q.code)}if(L.image){K.push(q.image)}if(L.imageAltText){K.push(q.imageAltText,"link")}if(L.imageMarker){K.push(q.imageMarker)}}if(L.header){K.push(q.header,q.header+"-"+L.header)}if(L.quote){K.push(q.quote);if(!o.maxBlockquoteDepth||o.maxBlockquoteDepth>=L.quote){K.push(q.quote+"-"+L.quote)}else{K.push(q.quote+"-"+o.maxBlockquoteDepth)}}if(L.list!==false){var J=(L.listStack.length-1)%3;if(!J){K.push(q.list1)}else{if(J===1){K.push(q.list2)}else{K.push(q.list3)}}}if(L.trailingSpaceNewLine){K.push("trailing-space-new-line")}else{if(L.trailingSpace){K.push("trailing-space-"+(L.trailingSpace%2?"a":"b"))}}return K.length?K.join(" "):null}function c(J,I){if(J.match(h,true)){return x(I)}return undefined}function u(O,N){var ab=N.text(O,N);if(typeof ab!=="undefined"){return ab}if(N.list){N.list=null;return x(N)}if(N.taskList){var W=O.match(B,true)[1]!=="x";if(W){N.taskOpen=true}else{N.taskClosed=true}if(o.highlightFormatting){N.formatting="task"}N.taskList=false;return x(N)}N.taskOpen=false;N.taskClosed=false;if(N.header&&O.match(/^#+$/,true)){if(o.highlightFormatting){N.formatting="header"}return x(N)}var S=O.next();if(N.linkTitle){N.linkTitle=false;var Z=S;if(S==="("){Z=")"}Z=(Z+"").replace(/([.?*+^\[\]\\(){}|-])/g,"\\$1");var K="^\\s*(?:[^"+Z+"\\\\]+|\\\\\\\\|\\\\.)"+Z;if(O.match(new RegExp(K),true)){return q.linkHref}}if(S==="`"){var Y=N.formatting;if(o.highlightFormatting){N.formatting="code"}O.eatWhile("`");var P=O.current().length;if(N.code==0){N.code=P;return x(N)}else{if(P==N.code){var U=x(N);N.code=0;return U}else{N.formatting=Y;return x(N)}}}else{if(N.code){return x(N)}}if(S==="\\"){O.next();if(o.highlightFormatting){var L=x(N);var R=q.formatting+"-escape";return L?L+" "+R:R}}if(S==="!"&&O.match(/\[[^\]]*\] ?(?:\(|\[)/,false)){N.imageMarker=true;N.image=true;if(o.highlightFormatting){N.formatting="image"}return x(N)}if(S==="["&&N.imageMarker&&O.match(/[^\]]*\](\(.*?\)| ?\[.*?\])/,false)){N.imageMarker=false;N.imageAltText=true;if(o.highlightFormatting){N.formatting="image"}return x(N)}if(S==="]"&&N.imageAltText){if(o.highlightFormatting){N.formatting="image"}var L=x(N);N.imageAltText=false;N.image=false;N.inline=N.f=i;return L}if(S==="["&&O.match(/[^\]]*\](\(.*\)| ?\[.*?\])/,false)&&!N.image){N.linkText=true;if(o.highlightFormatting){N.formatting="link"}return x(N)}if(S==="]"&&N.linkText&&O.match(/\(.*?\)| ?\[.*?\]/,false)){if(o.highlightFormatting){N.formatting="link"}var L=x(N);N.linkText=false;N.inline=N.f=i;return L}if(S==="<"&&O.match(/^(https?|ftps?):\/\/(?:[^\\>]|\\.)+>/,false)){N.f=N.inline=A;if(o.highlightFormatting){N.formatting="link"}var L=x(N);if(L){L+=" "}else{L=""}return L+q.linkInline}if(S==="<"&&O.match(/^[^> \\]+@(?:[^\\>]|\\.)+>/,false)){N.f=N.inline=A;if(o.highlightFormatting){N.formatting="link"}var L=x(N);if(L){L+=" "}else{L=""}return L+q.linkEmail}if(S==="<"&&O.match(/^(!--|[a-z]+(?:\s+[a-z_:.\-]+(?:\s*=\s*[^ >]+)?)*\s*>)/i,false)){var M=O.string.indexOf(">",O.pos);if(M!=-1){var X=O.string.substring(O.start,M);if(/markdown\s*=\s*('|"){0,1}1('|"){0,1}/.test(X)){N.md_inside=true}}O.backUp(1);N.htmlState=a.startState(j);return v(O,N,y)}if(S==="<"&&O.match(/^\/\w*?>/)){N.md_inside=false;return"tag"}else{if(S==="*"||S==="_"){var aa=1,V=O.pos==1?" ":O.string.charAt(O.pos-2);while(aa<3&&O.eat(S)){aa++}var J=O.peek()||" ";var T=!/\s/.test(J)&&(!l.test(J)||/\s/.test(V)||l.test(V));var ac=!/\s/.test(V)&&(!l.test(V)||/\s/.test(J)||l.test(J));var Q=null,I=null;if(aa%2){if(!N.em&&T&&(S==="*"||!ac||l.test(V))){Q=true}else{if(N.em==S&&ac&&(S==="*"||!T||l.test(J))){Q=false}}}if(aa>1){if(!N.strong&&T&&(S==="*"||!ac||l.test(V))){I=true}else{if(N.strong==S&&ac&&(S==="*"||!T||l.test(J))){I=false}}}if(I!=null||Q!=null){if(o.highlightFormatting){N.formatting=Q==null?"strong":I==null?"em":"strong em"}if(Q===true){N.em=S}if(I===true){N.strong=S}var U=x(N);if(Q===false){N.em=false}if(I===false){N.strong=false}return U}}else{if(S===" "){if(O.eat("*")||O.eat("_")){if(O.peek()===" "){return x(N)}else{O.backUp(1)}}}}}if(o.strikethrough){if(S==="~"&&O.eatWhile(S)){if(N.strikethrough){if(o.highlightFormatting){N.formatting="strikethrough"}var U=x(N);N.strikethrough=false;return U}else{if(O.match(/^[^\s]/,false)){N.strikethrough=true;if(o.highlightFormatting){N.formatting="strikethrough"}return x(N)}}}else{if(S===" "){if(O.match(/^~~/,true)){if(O.peek()===" "){return x(N)}else{O.backUp(2)}}}}}if(S===" "){if(O.match(/ +$/,false)){N.trailingSpace++}else{if(N.trailingSpace){N.trailingSpaceNewLine=true}}}return x(N)}function A(L,K){var J=L.next();if(J===">"){K.f=K.inline=u;if(o.highlightFormatting){K.formatting="link"}var I=x(K);if(I){I+=" "}else{I=""}return I+q.linkInline}L.match(/^[^>]+/,true);return q.linkInline}function i(K,J){if(K.eatSpace()){return null}var I=K.next();if(I==="("||I==="["){J.f=J.inline=k(I==="("?")":"]",0);if(o.highlightFormatting){J.formatting="link-string"}J.linkHref=true;return x(J)}return"error"}var e={")":/^(?:[^\\\(\)]|\\.|\((?:[^\\\(\)]|\\.)*\))*?(?=\))/,"]":/^(?:[^\\\[\]]|\\.|\[(?:[^\\\[\\]]|\\.)*\])*?(?=\])/};function k(I){return function(M,L){var K=M.next();if(K===I){L.f=L.inline=u;if(o.highlightFormatting){L.formatting="link-string"}var J=x(L);L.linkHref=false;return J}M.match(e[I]);L.linkHref=true;return x(L)}}function m(J,I){if(J.match(/^([^\]\\]|\\.)*\]:/,false)){I.f=F;J.next();if(o.highlightFormatting){I.formatting="link"}I.linkText=true;return x(I)}return g(J,I,u)}function F(K,J){if(K.match(/^\]:/,true)){J.f=J.inline=b;if(o.highlightFormatting){J.formatting="link"}var I=x(J);J.linkText=false;return I}K.match(/^([^\]\\]|\\.)+/,true);return q.linkText}function b(J,I){if(J.eatSpace()){return null}J.match(/^[^\s]+/,true);if(J.peek()===undefined){I.linkTitle=true}else{J.match(/^(?:\s+(?:"(?:[^"\\]|\\\\|\\.)+"|'(?:[^'\\]|\\\\|\\.)+'|\((?:[^)\\]|\\\\|\\.)+\)))?/,true)}I.f=I.inline=u;return q.linkHref+" url"}var r={startState:function(){return{f:n,prevLine:null,thisLine:null,block:n,htmlState:null,indentation:0,inline:u,text:c,formatting:false,linkText:false,linkHref:false,linkTitle:false,code:0,em:false,strong:false,header:0,hr:false,taskList:false,list:false,listStack:[],quote:0,trailingSpace:0,trailingSpaceNewLine:false,strikethrough:false,fencedChars:null}},copyState:function(I){return{f:I.f,prevLine:I.prevLine,thisLine:I.thisLine,block:I.block,htmlState:I.htmlState&&a.copyState(j,I.htmlState),indentation:I.indentation,localMode:I.localMode,localState:I.localMode?a.copyState(I.localMode,I.localState):null,inline:I.inline,text:I.text,formatting:false,linkTitle:I.linkTitle,code:I.code,em:I.em,strong:I.strong,strikethrough:I.strikethrough,header:I.header,hr:I.hr,taskList:I.taskList,list:I.list,listStack:I.listStack.slice(0),quote:I.quote,indentedCode:I.indentedCode,trailingSpace:I.trailingSpace,trailingSpaceNewLine:I.trailingSpaceNewLine,md_inside:I.md_inside,fencedChars:I.fencedChars}},token:function(L,K){K.formatting=false;if(L!=K.thisLine){var I=K.header||K.hr;K.header=0;K.hr=false;if(L.match(/^\s*$/,true)||I){s(K);if(!I){return null}K.prevLine=null}K.prevLine=K.thisLine;K.thisLine=L;K.taskList=false;K.trailingSpace=0;K.trailingSpaceNewLine=false;K.f=K.block;var J=L.match(/^\s*/,true)[0].replace(/\t/g,"    ").length;K.indentationDiff=Math.min(J-K.indentation,4);K.indentation=K.indentation+K.indentationDiff;if(J>0){return null}}return K.f(L,K)},innerMode:function(I){if(I.block==y){return{state:I.htmlState,mode:j}}if(I.localState){return{state:I.localState,mode:I.localMode}}return{state:I,mode:r}},blankLine:s,getType:x,closeBrackets:"()[]{}''\"\"``",fold:"markdown"};return r},"xml");a.defineMIME("text/x-markdown","markdown")});