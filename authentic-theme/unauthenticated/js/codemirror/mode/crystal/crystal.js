(function(a){if(typeof exports=="object"&&typeof module=="object"){a(require("../../lib/codemirror"))}else{if(typeof define=="function"&&define.amd){define(["../../lib/codemirror"],a)}else{a(CodeMirror)}}})(function(a){a.defineMode("crystal",function(B){function v(F,E){return new RegExp((E?"":"^")+"(?:"+F.join("|")+")"+(E?"$":"\\b"))}function r(G,F,E){E.tokenize.push(G);return G(F,E)}var u=/^(?:[-+/%|&^]|\*\*?|[<>]{2})/;var j=/^(?:[=!]~|===|<=>|[<>=!]=?|[|&]{2}|~)/;var w=/^(?:\[\][?=]?)/;var p=/^(?:\.(?:\.{2})?|->|[?:])/;var m=/^[a-z_\u009F-\uFFFF][a-zA-Z0-9_\u009F-\uFFFF]*/;var n=/^[A-Z_\u009F-\uFFFF][a-zA-Z0-9_\u009F-\uFFFF]*/;var i=v(["abstract","alias","as","asm","begin","break","case","class","def","do","else","elsif","end","ensure","enum","extend","for","fun","if","include","instance_sizeof","lib","macro","module","next","of","out","pointerof","private","protected","rescue","return","require","select","sizeof","struct","super","then","type","typeof","uninitialized","union","unless","until","when","while","with","yield","__DIR__","__END_LINE__","__FILE__","__LINE__"]);var d=v(["true","false","nil","self"]);var l=["def","fun","macro","class","module","struct","lib","enum","union","do","for"];var c=v(l);var D=["if","unless","case","while","until","begin","then"];var q=v(D);var s=["end","else","elsif","rescue","ensure"];var b=v(s);var e=["\\)","\\}","\\]"];var o=new RegExp("^(?:"+e.join("|")+")$");var k={def:h,fun:h,macro:y,"class":A,module:A,struct:A,lib:A,"enum":A,union:A};var f={"[":"]","{":"}","(":")","<":">"};function C(I,G){if(I.eatSpace()){return null}if(G.lastToken!="\\"&&I.match("{%",false)){return r(z("%","%"),I,G)}if(G.lastToken!="\\"&&I.match("{{",false)){return r(z("{","}"),I,G)}if(I.peek()=="#"){I.skipToEnd();return"comment"}var E;if(I.match(m)){I.eat(/[?!]/);E=I.current();if(I.eat(":")){return"atom"}else{if(G.lastToken=="."){return"property"}else{if(i.test(E)){if(c.test(E)){if(!(E=="fun"&&G.blocks.indexOf("lib")>=0)&&!(E=="def"&&G.lastToken=="abstract")){G.blocks.push(E);G.currentIndent+=1}}else{if((G.lastStyle=="operator"||!G.lastStyle)&&q.test(E)){G.blocks.push(E);G.currentIndent+=1}else{if(E=="end"){G.blocks.pop();G.currentIndent-=1}}}if(k.hasOwnProperty(E)){G.tokenize.push(k[E])}return"keyword"}else{if(d.test(E)){return"atom"}}}}return"variable"}if(I.eat("@")){if(I.peek()=="["){return r(t("[","]","meta"),I,G)}I.eat("@");I.match(m)||I.match(n);return"variable-2"}if(I.match(n)){return"tag"}if(I.eat(":")){if(I.eat('"')){return r(x('"',"atom",false),I,G)}else{if(I.match(m)||I.match(n)||I.match(u)||I.match(j)||I.match(w)){return"atom"}}I.eat(":");return"operator"}if(I.eat('"')){return r(x('"',"string",true),I,G)}if(I.peek()=="%"){var F="string";var J=true;var H;if(I.match("%r")){F="string-2";H=I.next()}else{if(I.match("%w")){J=false;H=I.next()}else{if(I.match("%q")){J=false;H=I.next()}else{if(H=I.match(/^%([^\w\s=])/)){H=H[1]}else{if(I.match(/^%[a-zA-Z0-9_\u009F-\uFFFF]*/)){return"meta"}else{return"operator"}}}}}if(f.hasOwnProperty(H)){H=f[H]}return r(x(H,F,J),I,G)}if(E=I.match(/^<<-('?)([A-Z]\w*)\1/)){return r(g(E[2],!E[1]),I,G)}if(I.eat("'")){I.match(/^(?:[^']|\\(?:[befnrtv0'"]|[0-7]{3}|u(?:[0-9a-fA-F]{4}|\{[0-9a-fA-F]{1,6}\})))/);I.eat("'");return"atom"}if(I.eat("0")){if(I.eat("x")){I.match(/^[0-9a-fA-F]+/)}else{if(I.eat("o")){I.match(/^[0-7]+/)}else{if(I.eat("b")){I.match(/^[01]+/)}}}return"number"}if(I.eat(/^\d/)){I.match(/^\d*(?:\.\d+)?(?:[eE][+-]?\d+)?/);return"number"}if(I.match(u)){I.eat("=");return"operator"}if(I.match(j)||I.match(p)){return"operator"}if(E=I.match(/[({[]/,false)){E=E[0];return r(t(E,f[E],null),I,G)}if(I.eat("\\")){I.next();return"meta"}I.next();return null}function t(H,F,G,E){return function(K,J){if(!E&&K.match(H)){J.tokenize[J.tokenize.length-1]=t(H,F,G,true);J.currentIndent+=1;return G}var I=C(K,J);if(K.current()===F){J.tokenize.pop();J.currentIndent-=1;I=G}return I}}function z(G,F,E){return function(I,H){if(!E&&I.match("{"+G)){H.currentIndent+=1;H.tokenize[H.tokenize.length-1]=z(G,F,true);return"meta"}if(I.match(F+"}")){H.currentIndent-=1;H.tokenize.pop();return"meta"}return C(I,H)}}function y(G,F){if(G.eatSpace()){return null}var E;if(E=G.match(m)){if(E=="def"){return"keyword"}G.eat(/[?!]/)}F.tokenize.pop();return"def"}function h(F,E){if(F.eatSpace()){return null}if(F.match(m)){F.eat(/[!?]/)}else{F.match(u)||F.match(j)||F.match(w)}E.tokenize.pop();return"def"}function A(F,E){if(F.eatSpace()){return null}F.match(n);E.tokenize.pop();return"def"}function x(E,F,G){return function(K,I){var J=false;while(K.peek()){if(!J){if(K.match("{%",false)){I.tokenize.push(z("%","%"));return F}if(K.match("{{",false)){I.tokenize.push(z("{","}"));return F}if(G&&K.match("#{",false)){I.tokenize.push(t("#{","}","meta"));return F}var H=K.next();if(H==E){I.tokenize.pop();return F}J=G&&H=="\\"}else{K.next();J=false}}return F}}function g(E,F){return function(I,G){if(I.sol()){I.eatSpace();if(I.match(E)){G.tokenize.pop();return"string"}}var H=false;while(I.peek()){if(!H){if(I.match("{%",false)){G.tokenize.push(z("%","%"));return"string"}if(I.match("{{",false)){G.tokenize.push(z("{","}"));return"string"}if(F&&I.match("#{",false)){G.tokenize.push(t("#{","}","meta"));return"string"}H=F&&I.next()=="\\"}else{I.next();H=false}}return"string"}}return{startState:function(){return{tokenize:[C],currentIndent:0,lastToken:null,lastStyle:null,blocks:[]}},token:function(H,G){var F=G.tokenize[G.tokenize.length-1](H,G);var E=H.current();if(F&&F!="comment"){G.lastToken=E;G.lastStyle=F}return F},indent:function(F,E){E=E.replace(/^\s*(?:\{%)?\s*|\s*(?:%\})?\s*$/g,"");if(b.test(E)||o.test(E)){return B.indentUnit*(F.currentIndent-1)}return B.indentUnit*F.currentIndent},fold:"indent",electricInput:v(e.concat(s),true),lineComment:"#"}});a.defineMIME("text/x-crystal","crystal")});